<% content_for :isi do %>
  <div class="container-fluid mt--6">
    <div class="row">
      <div class="col-md-3">
        <div class="card">
          <div class="card-body">
            <div class="row justify-content-between align-items-center">
              <div class="col">
                <h3 class="mb-0">Identitas Pasien</h3>
              </div>
              <div class="col-auto">
                <%
                  get_reference_patient = LContactList::ContactPatient.where(main_patient_child_id: @main_patient.id).last
                  reference_patient = Main::Patient.find(get_reference_patient.patient.id)
                %>
              <% if !reference_patient.nil? %>
                <%= link_to "Kontak Sebelumnya", main_patient_path(reference_patient.slug),
                  class: 'btn btn-sm btn-neutral' %>
              <% end %>
              <button 
                  class="btn btn-primary btn-sm"
                  type="button" 
                  data-toggle="collapse" 
                  data-target="#collapseExample" 
                  aria-expanded="false" 
                  aria-controls="collapseExample">Detail</button>
              </div>
            </div>
            <div class="my-1">
              <span class="h6 surtitle text-muted">
                Nama
              </span>
              <div class="row">
                <div class="col">
                  <div class="h4 mb-0">
                    <%= @main_patient.name %>
                  </div>
                </div>
                <div class="col-auto">
                  <% l_six = LSix::First.where(main_patient_id: @main_patient).lastest_by_patient.first %>
                  <% if !l_six.nil? %>
                    <% case l_six.criteria 
                        when "Orang Dalam Pengawasan" %><span class="badge badge-warning">ODP</span>
                      <% when "Pasien Dalam Pengawasan" %><span class="badge badge-warning">PDP</span>
                      <% when "Kasus Probabel" %><span class="badge badge-warning">OTG</span>
                      <% when "Kasus Konfirmasi" %><span class="badge badge-danger">Konfirmasi</span>
                      <% when "Selesai Pemantauan" %><span class="badge badge-success">Selesai</span>
                    <% end %>
                  <% end %>
                  <span class="badge badge-danger">Danger</span>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col">
                <span class="h6 surtitle text-muted">Alamat</span>
                <span class="d-block h4">
                  <%= @main_patient.residence_address %>   
                  RT.<%= @main_patient.neighborhood_association.neighborhood_association %> 
                  RW.<%= @main_patient.citizen_association.citizen_association %>
                  <br>
                  <%= @main_patient.sub_district.sub_district %> - <%= @main_patient.district.district %>
                  <br>
                  <%= @main_patient.city.city %>
                </span>
                <div class="collapse" id="collapseExample">
                  <span class="h6 surtitle text-muted">NIK/No.KTP</span>
                  <span class="d-block h4">
                    <%= @main_patient.no_identity %>
                  </span>

                  <span class="h6 surtitle text-muted">Tgl Lahir</span>
                  <span class="d-block h4">
                    <%= @main_patient.date_of_birth %>
                  </span>

                  <span class="h6 surtitle text-muted">Jenis Kelamin</span>
                  <span class="d-block h4">
                    <%= @main_patient.gender == 'Male' ? 'Laki-laki' : 'Perempuan' %>
                  </span>

                  <span class="h6 surtitle text-muted">Alamat KTP</span>
                  <span class="d-block h4">
                    <%= @main_patient.address %>
                  </span>

                  <span class="h6 surtitle text-muted">Status Perkawinan</span>
                  <span class="d-block h4">
                    <%= @main_patient.marital_status.marital_status %>
                  </span>

                  <span class="h6 surtitle text-muted">Nama Orang Tua</span>
                  <span class="d-block h4">
                    <%= @main_patient.name_of_parent %>
                  </span>

                  <span class="h6 surtitle text-muted">Telepon</span>
                  <span class="d-block h4">
                    <%= @main_patient.phone_number %>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-9">
        <div class="card">
          <div class="card-header border-0">
            <div class="row">
              <div class="col">
                <h3 class="mb-0">Daftar Kontak Erat</h3>
              </div>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table align-items-center table-flush table-striped">
              <thead class="thead-light">
                <tr>
                  <th>Nama</th>
                  <th>Alamat</th>
                  <th>Banyak Kontak</th>
                  <th>Kriteria</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% @main_patient.contact_patient_childs.each do |contact_patient_child|%>
                <tr>
                  <td><%= contact_patient_child.patient_child.name  %></td>
                  <td style="white-space:normal;">
                    <%= contact_patient_child.patient_child.address %>,
                    <%= contact_patient_child.patient_child.city.city %>,
                    <%= contact_patient_child.patient_child.district.district %>,
                    <%= contact_patient_child.patient_child.sub_district.sub_district %>, RW
                    <%= contact_patient_child.patient_child.neighborhood_association.neighborhood_association %>/RT 
                    <%= contact_patient_child.patient_child.citizen_association.citizen_association %>
                  </td>
                  <td><%= contact_patient_child.patient_child.contact_patients.count %></td>
                  <% l_six = LSix::First.where(main_patient_id: contact_patient_child.patient_child).lastest_by_patient.first %>
                  <td>
                    <% if !l_six.nil? %>
                      <% case l_six.criteria 
                           when "Orang Dalam Pengawasan" %><span class="text-warning">ODP</span>
                        <% when "Pasien Dalam Pengawasan" %><span class="text-warning">PDP</span>
                        <% when "Kasus Probabel" %><span class="text-warning">OTG</span>
                        <% when "Kasus Konfirmasi" %><span class="text-danger">Konfirmasi</span>
                        <% when "Selesai Pemantauan" %><span class="text-success">Selesai</span>
                      <% end  %>
                    <% end %>
                  </td>
                  <td class="text-right">
                      <%= link_to main_patient_path(contact_patient_child.patient_child), class: 'btn btn-sm btn-danger btn-icon-only' do %>
                        <% icon('far', 'id-card') %>
                      <% end %>
                   </td>
                </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>
<% if notice %>
  <div class="notifikasi" data-notifikasi="<%= notice %>"></div>
<% end %>
<%= render partial: 'layouts/body' %>
